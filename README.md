# chat1-azure
Azure deployment scripts for chat demo app

## Prerequisites
- PowerShell 5.1 +
- Az module for PowerShell insalled (https://docs.microsoft.com/en-us/powershell/azure/install-az-ps?view=azps-3.1.0)


## Initial configuration
- Create a service principal in your Azure tenant (one time operation). The credentials of this service principal will be used for running automated scripts. When **create-service-principal.ps1** script is executed for the first time, a new service principal is created in the Azure tenant with the display name specified in file **config.json** and a random password generated by Azure for this principal is saved to file **config\protected\servicePrincipalPassword.enc** in encrypted format. The password file is excluded from git source control, and the file can only be decrypted on the same machine by the same user who originally ran the script. Additional work will be required to add support to allow secure transfer of service principal password files to another machines (convert the password from SecureString to plain text, use machine/user independant keys when running ConvertFrom-SecureString and etc.)
**Execute:** ```C:\work\source\chat1\chat1-azure> .\common\create-service-principal.ps1```

- Create resource group in tenant to host all Azure resources used by the project (one time operation). The security principal should be already created before this step. After the resource group is created the security principal is granted Owner role permissions for it and all other scripts can be run without prompting for the tenant admin credentials in fully automated way.   
**Execute:** ```C:\work\source\chat1\chat1-azure> .\common\create-resource-group.ps1```


## Connecting to Azure
- Make sure that Azure tenant parameters are configured in config/config.json file, service principal for scripts has been created and that the service principal password file exists at **config\protected\servicePrincipalPassword.enc**  
**Execute:** ```C:\work\source\chat1\chat1-azure> .\common\connect-azure.ps1```